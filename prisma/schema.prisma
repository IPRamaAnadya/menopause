model faqs {
  id                Int                @id @default(autoincrement())
  is_active         Boolean            @default(true)
  order             Int                @default(0)
  created_at        DateTime           @default(now())
  updated_at        DateTime           @updatedAt
  faq_translations  faq_translations[]

  @@index([is_active])
  @@index([order])
}

model faq_translations {
  id         Int      @id @default(autoincrement())
  faq_id     Int
  locale     String   @db.VarChar(10)
  question   String
  answer     String   @db.Text
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  faqs       faqs     @relation(fields: [faq_id], references: [id], onDelete: Cascade)

  @@unique([faq_id, locale])
  @@index([locale])
}
generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model accounts {
  id                  Int     @id @default(autoincrement())
  user_id             Int
  type                String
  provider            String
  provider_account_id String
  refresh_token       String?
  access_token        String?
  expires_at          Int?
  token_type          String?
  scope               String?
  id_token            String?
  session_state       String?
  users               users   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([provider, provider_account_id])
}

model membership_levels {
  id            Int           @id @default(autoincrement())
  name          String        @unique
  priority      Int           @unique
  price         Decimal       @db.Decimal(10, 2)
  duration_days Int
  created_at    DateTime      @default(now())
  updated_at    DateTime      @updatedAt
  slug          String        @unique
  memberships   memberships[]

  event_prices  event_prices[]
  event_registrations event_registrations[]
}

model memberships {
  id                  Int               @id @default(autoincrement())
  user_id             Int
  membership_level_id Int
  start_date          DateTime
  end_date            DateTime
  status              MembershipStatus  @default(ACTIVE)
  created_at          DateTime          @default(now())
  updated_at          DateTime          @updatedAt
  membership_levels   membership_levels @relation(fields: [membership_level_id], references: [id])
  users               users             @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([user_id])
}

model permissions {
  id               Int                @id @default(autoincrement())
  name             String             @unique
  slug             String             @unique
  created_at       DateTime           @default(now())
  updated_at       DateTime           @updatedAt
  role_permissions role_permissions[]
}

model role_permissions {
  role_id       Int
  permission_id Int
  permissions   permissions @relation(fields: [permission_id], references: [id], onDelete: Cascade)
  roles         roles       @relation(fields: [role_id], references: [id], onDelete: Cascade)

  @@id([role_id, permission_id])
}

model roles {
  id               Int                @id @default(autoincrement())
  name             String             @unique
  slug             String             @unique
  created_at       DateTime           @default(now())
  updated_at       DateTime           @updatedAt
  role_permissions role_permissions[]
  user_roles       user_roles[]
}

model sessions {
  id            Int      @id @default(autoincrement())
  session_token String   @unique
  user_id       Int
  expires       DateTime
  users         users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model user_roles {
  user_id    Int
  role_id    Int
  created_at DateTime @default(now())
  roles      roles    @relation(fields: [role_id], references: [id], onDelete: Cascade)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@id([user_id, role_id])
}

model users {
  id                Int           @id @default(autoincrement())
  public_id         String        @unique @default(uuid())
  email             String        @unique
  name              String?
  created_at        DateTime      @default(now())
  updated_at        DateTime      @updatedAt
  password          String?
  provider          AuthProvider  @default(EMAIL)
  status            UserStatus    @default(ACTIVE)
  email_verified    DateTime?
  image             String?
  is_reset_password Boolean       @default(false)
  accounts          accounts[]
  memberships       memberships[]
  sessions          sessions[]
  user_roles        user_roles[]
  articles          articles[]
  article_reviews   article_reviews[]
  orders            orders[]

  events_created  events[]       
  event_registrations event_registrations[]

}

model services {
  id                    Int                     @id @default(autoincrement())
  image_url             String?
  is_active             Boolean                 @default(true)
  order                 Int                     @default(0)
  created_at            DateTime                @default(now())
  updated_at            DateTime                @updatedAt
  service_translations  service_translations[]

  @@index([is_active])
  @@index([order])
}

model service_translations {
  id          Int      @id @default(autoincrement())
  service_id  Int
  locale      String   @db.VarChar(10)
  title       String
  description String   @db.Text
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  services    services @relation(fields: [service_id], references: [id], onDelete: Cascade)

  @@unique([service_id, locale])
  @@index([locale])
}

model verification_tokens {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

enum AuthProvider {
  EMAIL
  GOOGLE
  FACEBOOK
  APPLE
}

enum MembershipStatus {
  ACTIVE
  EXPIRED
  CANCELLED
  STOPPED
}

enum UserStatus {
  ACTIVE
  SUSPENDED
}

enum ArticleVisibility {
  PUBLIC
  MEMBER
  PRIORITY
}

enum OrderType {
  SUBSCRIPTION
  EVENT
  PRODUCT
  MEMBERSHIP_PURCHASE
  MEMBERSHIP_RENEWAL
  MEMBERSHIP_UPGRADE
  MEMBERSHIP_DOWNGRADE
}

enum OrderStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
  CANCELLED
}

enum PaymentProvider {
  STRIPE
  MIDTRANS
  XENDIT
  ADMIN
}

enum PaymentStatus {
  PENDING
  PROCESSING
  SUCCEEDED
  FAILED
  CANCELLED
}

model categories {
  id                      Int                       @id @default(autoincrement())
  parent_id               Int?
  slug                    String                    @unique @db.VarChar(255)
  order                   Int                       @default(0)
  is_active               Boolean                   @default(true)
  created_at              DateTime                  @default(now())
  updated_at              DateTime                  @updatedAt
  parent                  categories?               @relation("CategoryChildren", fields: [parent_id], references: [id], onDelete: Cascade)
  children                categories[]              @relation("CategoryChildren")
  category_translations   category_translations[]
  articles                articles[]

  @@index([parent_id])
  @@index([slug])
  @@index([is_active])
  @@index([order])
}

model category_translations {
  id          Int        @id @default(autoincrement())
  category_id Int
  locale      String     @db.VarChar(10)
  name        String     @db.VarChar(255)
  description String?    @db.Text
  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt
  categories  categories @relation(fields: [category_id], references: [id], onDelete: Cascade)

  @@unique([category_id, locale])
  @@index([locale])
}

model articles {
  id                 Int                  @id @default(autoincrement())
  public_id          String               @unique @default(uuid()) @db.Uuid
  category_id        Int
  author_id          Int
  slug               String               @unique @db.VarChar(255)
  image_url          String?              @db.Text
  tags               String[]             @default([])
  visibility         ArticleVisibility    @default(PUBLIC)
  required_priority  Int?                 @db.SmallInt
  is_published       Boolean              @default(false)
  is_highlighted     Boolean              @default(false)
  published_at       DateTime?
  created_at         DateTime             @default(now())
  updated_at         DateTime             @updatedAt
  categories         categories           @relation(fields: [category_id], references: [id], onDelete: Cascade)
  author             users                @relation(fields: [author_id], references: [id], onDelete: Cascade)
  article_translations article_translations[]
  article_reviews    article_reviews[]

  @@index([category_id])
  @@index([author_id])
  @@index([slug])
  @@index([visibility])
  @@index([is_published])
  @@index([is_highlighted])
  @@index([published_at])
}

model article_translations {
  id          Int      @id @default(autoincrement())
  article_id  Int
  locale      String   @db.VarChar(10)
  title       String   @db.VarChar(255)
  excerpt     String?  @db.Text
  description String   @db.Text
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  articles    articles @relation(fields: [article_id], references: [id], onDelete: Cascade)

  @@unique([article_id, locale])
  @@index([locale])
}

model article_reviews {
  id          Int               @id @default(autoincrement())
  article_id  Int
  user_id     Int
  parent_id   Int?
  content     String            @db.Text
  rating      Int?              @db.SmallInt
  created_at  DateTime          @default(now())
  updated_at  DateTime          @updatedAt
  article     articles          @relation(fields: [article_id], references: [id], onDelete: Cascade)
  user        users             @relation(fields: [user_id], references: [id], onDelete: Cascade)
  parent      article_reviews?  @relation("ReviewReplies", fields: [parent_id], references: [id], onDelete: Cascade)
  replies     article_reviews[] @relation("ReviewReplies")

  @@index([article_id])
  @@index([user_id])
  @@index([parent_id])
}

model orders {
  id             Int          @id @default(autoincrement())
  public_id      String       @unique @default(uuid()) @db.Uuid
  user_id        Int
  order_number   String       @unique
  type           OrderType
  status         OrderStatus  @default(PENDING)
  gross_amount   Decimal      @db.Decimal(10, 2)
  currency       String       @db.VarChar(3)
  breakdown      Json
  reference_id   Int?
  reference_type String?      @db.VarChar(50)
  metadata       Json?
  notes          String?      @db.Text
  expires_at     DateTime?
  paid_at        DateTime?
  created_at     DateTime     @default(now())
  updated_at     DateTime     @updatedAt
  users          users        @relation(fields: [user_id], references: [id], onDelete: Cascade)
  payments       payments[]

  @@index([user_id])
  @@index([status])
  @@index([type])
  @@index([order_number])
  @@index([reference_id, reference_type])
  @@index([created_at])
}

model payments {
  id                Int             @id @default(autoincrement())
  public_id         String          @unique @default(uuid()) @db.Uuid
  order_id          Int
  provider          PaymentProvider
  status            PaymentStatus   @default(PENDING)
  amount            Decimal         @db.Decimal(10, 2)
  currency          String          @db.VarChar(3)
  fee_amount        Decimal?        @db.Decimal(10, 2)
  net_amount        Decimal?        @db.Decimal(10, 2)
  provider_ref      String?         @db.VarChar(255)
  provider_payload  Json?
  payment_method    String?         @db.VarChar(50)
  failure_reason    String?         @db.Text
  processed_at      DateTime?
  created_at        DateTime        @default(now())
  updated_at        DateTime        @updatedAt
  orders            orders          @relation(fields: [order_id], references: [id], onDelete: Cascade)

  @@index([order_id])
  @@index([provider])
  @@index([status])
  @@index([provider_ref])
  @@index([created_at])
}

/////////////////////////////
// EVENT MODELS (FINAL)
/////////////////////////////

model events {
  id             Int            @id @default(autoincrement())
  public_id      String         @unique @default(uuid()) @db.Uuid
  slug           String         @unique @db.VarChar(255)
  image_url      String?        @db.Text

  start_date     String         @db.VarChar(255)
  end_date       String         @db.VarChar(255)
  start_time     String?        @db.VarChar(255)
  end_time       String?        @db.VarChar(255)

  is_online      Boolean        @default(false)
  meeting_url    String?

  // OFFLINE EVENT LOCATION
  latitude       Decimal?       @db.Decimal(10, 8)
  longitude      Decimal?       @db.Decimal(11, 8)

  is_paid        Boolean        @default(false)

  capacity       Int?
  is_public      Boolean        @default(true)
  is_highlighted Boolean        @default(false)
  status         EventStatus    @default(DRAFT)
  created_by     Int
  created_at     DateTime       @default(now())
  updated_at     DateTime       @updatedAt

  creator        users          @relation(fields: [created_by], references: [id])
  translations   event_translations[]
  prices         event_prices[]
  registrations  event_registrations[]

  @@index([slug])
  @@index([status])
  @@index([start_date])
  @@index([is_public])
  @@index([is_paid])
  @@index([is_highlighted])
}

model event_translations {
  id                 Int      @id @default(autoincrement())
  event_id           Int
  locale             String   @db.VarChar(10)

  title              String   @db.VarChar(255)
  short_description  String?
  description        String   @db.Text

  // OFFLINE EVENT LOCATION (MULTI LANGUAGE)
  place_name         String?  @db.VarChar(255)
  place_detail       String?  @db.Text

  created_at         DateTime @default(now())
  updated_at         DateTime @updatedAt

  events             events   @relation(fields: [event_id], references: [id], onDelete: Cascade)

  @@unique([event_id, locale])
  @@index([locale])
}

model event_prices {
  id                    Int      @id @default(autoincrement())
  event_id              Int

  // NULL = PUBLIC
  membership_level_id   Int?

  price                 Decimal  @db.Decimal(10, 2)
  quota                 Int?
  is_active             Boolean  @default(true)
  created_at            DateTime @default(now())
  updated_at            DateTime @updatedAt

  events                events              @relation(fields: [event_id], references: [id], onDelete: Cascade)
  membership_levels     membership_levels?  @relation(fields: [membership_level_id], references: [id])

  @@unique([event_id, membership_level_id])
  @@index([event_id])
}

model event_registrations {
  id                    Int      @id @default(autoincrement())
  public_id             String   @unique @default(uuid()) @db.Uuid
  event_id              Int
  user_id               Int?     // null = guest

  // NULL = PUBLIC
  membership_level_id   Int?

  price                 Decimal  @db.Decimal(10, 2)
  status                EventRegistrationStatus @default(PENDING)
  registered_at         DateTime @default(now())
  updated_at            DateTime @updatedAt

  events                events              @relation(fields: [event_id], references: [id], onDelete: Cascade)
  users                 users?              @relation(fields: [user_id], references: [id], onDelete: Cascade)
  membership_levels     membership_levels?  @relation(fields: [membership_level_id], references: [id])

  guests                event_guests?

  @@index([event_id])
  @@index([user_id])
  @@index([status])
}

model event_guests {
  id               Int      @id @default(autoincrement())
  registration_id  Int      @unique
  full_name        String
  email            String
  phone            String?
  created_at       DateTime @default(now())

  registration     event_registrations @relation(fields: [registration_id], references: [id], onDelete: Cascade)
}

/////////////////////////////
// EVENT ENUMS
/////////////////////////////

enum EventStatus {
  DRAFT
  PUBLISHED
  CANCELLED
  ENDED
}

enum EventRegistrationStatus {
  PENDING
  PAID
  CANCELLED
  ATTENDED
}